<div class="cycle-list-container">
    <div class="header">
      <h2>Laundry Cycles</h2>
      <button mat-raised-button color="primary" (click)="onStartNewCycle()">
        <mat-icon>add</mat-icon>
        Start New Cycle
      </button>
    </div>
  
    <div class="cycles-grid">
      @for (cycle of cycles$ | async; track cycle.id) {
        <mat-card class="cycle-card">
          <mat-card-header>
            <mat-card-title>{{ cycle.device?.name || 'Unknown Device' }}</mat-card-title>
            <mat-card-subtitle>{{ cycle.device?.type | titlecase }} - {{ cycle.userId }}</mat-card-subtitle>
            <div class="status-chip">
              <mat-chip [class]="getStatusClass(cycle.status)">
                {{ getStatusDisplay(cycle.status) }}
              </mat-chip>
            </div>
          </mat-card-header>
          
          <mat-card-content>
            <div class="cycle-details">
              <div class="detail-row">
                <mat-icon>schedule</mat-icon>
                <span>Started: {{ formatDate(cycle.startedAt) }}</span>
              </div>
              
              @if (cycle.stoppedAt) {
                <div class="detail-row">
                  <mat-icon>stop</mat-icon>
                  <span>Stopped: {{ formatDate(cycle.stoppedAt) }}</span>
                </div>
              }
              
              @if (cycle.tariff) {
                <div class="detail-row">
                  <mat-icon>euro</mat-icon>
                  <span>{{ cycle.tariff.name }} - â‚¬{{ cycle.tariff.price }}</span>
                </div>
              }
              
              @if (cycle.invoiceLines && cycle.invoiceLines.length > 0) {
                <div class="invoice-section">
                  <h4>Invoice</h4>
                  @for (line of cycle.invoiceLines; track line.name) {
                    <div class="invoice-line">
                      <span>{{ line.name }}</span>
                      <span class="price">{{ line.totalPrice }} {{ line.currency }}</span>
                    </div>
                  }
                </div>
              }
            </div>
          </mat-card-content>
          
          <mat-card-actions align="end" *ngIf="canEndCycle(cycle.status)">
            <button mat-raised-button color="warn" (click)="onEndCycle(cycle.id)">
              <mat-icon>stop</mat-icon>
              End Cycle
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  </div>